(()=>{"use strict";class t{constructor({id:t,name:e,description:n,status:s,created:c}){this.id=t,this.name=e,this.description=n,this.status=s,this.created=c}}const e=async(t={})=>{const{url:e,method:n="GET",headers:s={},body:c=null}=t;try{const t={method:n,headers:{"Content-Type":"application/json",...s}};c&&(t.body=JSON.stringify(c));const o=await fetch(e,t);if(!o.ok){const t=await o.json().catch((()=>({})));throw new Error(`Ошибка: ${o.status} ${o.statusText} \n ${JSON.stringify(t)}`)}return 204===o.status?null:await o.json()}catch(t){throw console.error("Ошибка при выполнении запроса:",t),t}};class n{constructor(t){this.baseUrl=t}async list(){try{return await e({url:`${this.baseUrl}?method=allTickets`})}catch(t){console.error(t)}}async get(t){try{return await e({url:`${this.baseUrl}?method=ticketById&id=${t}`})}catch(t){throw console.error(t),t}}async create(t){try{return await e({url:`${this.baseUrl}?method=createTicket`,method:"POST",body:t})}catch(t){throw console.error(t),t}}async update(t,n){try{await e({url:`${this.baseUrl}?method=updateById&id=${t}`,method:"POST",body:n})}catch(t){throw console.error(t),t}}async delete(t){try{await e({url:`${this.baseUrl}?method=deleteById&id=${t}`})}catch(t){throw console.error(t),t}}}class s{constructor(t){this.helpDesk=t,this.ticketService=new n(i),this.deleteForm=this.deleteForm.bind(this),this.sendForm=this.sendForm.bind(this)}renderForm(){const t=document.createElement("form");t.classList.add("form");const e=document.createElement("p");e.classList.add("title"),e.textContent="Добавить тикет";const n=document.createElement("label");n.classList.add("short-description-label"),n.textContent="Короткое описание";const s=document.createElement("input");s.classList.add("short-description-input"),s.type="text";const c=document.createElement("label");c.classList.add("long-description-label"),c.textContent="Подробное описание";const o=document.createElement("input");o.classList.add("long-description-input"),o.type="text";const i=document.createElement("div");i.classList.add("button-block");const r=document.createElement("a");r.classList.add("cancel-button"),r.textContent="Отмена";const a=document.createElement("a");return a.classList.add("approve-button"),a.textContent="Ок",i.append(r,a),t.append(e,n,s,c,o,i),r.addEventListener("click",this.deleteForm),a.addEventListener("click",this.sendForm),t}deleteForm(){const t=document.querySelector(".form");t&&t.remove()}async sendForm(){const t=document.querySelector(".short-description-input").value,e=document.querySelector(".long-description-input").value;try{if(!t)return;await this.ticketService.create({name:t,description:e}),this.deleteForm(),await this.helpDesk.renderTicketList()}catch(t){console.error("Что-то пошло не так при создании тикета:",t.message)}}}class c{constructor(t,e){this.helpDesk=t,this.ticketService=e,this.deleteForm=this.deleteForm.bind(this),this.sendForm=this.sendForm.bind(this)}renderForm(t){const e=document.createElement("form");e.classList.add("form"),e.setAttribute("data-id",t.id);const n=document.createElement("p");n.classList.add("title"),n.textContent="Изменить тикет";const s=document.createElement("label");s.classList.add("short-description-label"),s.textContent="Короткое описание";const c=document.createElement("input");c.classList.add("short-description-input"),c.type="text",c.value=t.name;const o=document.createElement("label");o.classList.add("long-description-label"),o.textContent="Подробное описание";const i=document.createElement("input");i.classList.add("long-description-input"),i.type="text",i.value=t.description;const r=document.createElement("div");r.classList.add("button-block");const a=document.createElement("a");a.classList.add("cancel-button"),a.textContent="Отмена";const d=document.createElement("a");return d.classList.add("approve-button"),d.textContent="Ок",r.append(a,d),e.append(n,s,c,o,i,r),a.addEventListener("click",this.deleteForm),d.addEventListener("click",this.sendForm),e}deleteForm(){const t=document.querySelector(".form");t&&t.remove()}async sendForm(){const t=document.querySelector(".short-description-input").value,e=document.querySelector(".long-description-input").value,n=document.querySelector(".form").getAttribute("data-id");try{if(!t)return;await this.ticketService.update(n,{name:t,description:e}),this.deleteForm(),await this.helpDesk.renderTicketList()}catch(t){console.error("Что-то пошло не так при создании тикета:",t.message)}}}class o{constructor(t,e){this.ticketService=new n(i),this.tickets=t,this.helpDesk=e,this.updateModal=new c(this.helpDesk,this.ticketService),this.onDoneButton=this.onDoneButton.bind(this),this.onUpdateButton=this.onUpdateButton.bind(this),this.onDeleteButton=this.onDeleteButton.bind(this),this.sendDeleteRequest=this.sendDeleteRequest.bind(this),this.closeDeleteBlock=this.closeDeleteBlock.bind(this),this.onTicketClick=this.onTicketClick.bind(this)}renderTicket(t,e,n,s){const c=new Date(e).toLocaleString(),o=document.createElement("li");o.classList.add("ticket-wrapper"),o.setAttribute("data-id",s),o.setAttribute("data-status",n);const i=document.createElement("div");i.classList.add("left-block");const r=document.createElement("div");r.classList.add("right-block");const a=document.createElement("a");a.classList.add("done-button"),n&&(a.textContent="V");const d=document.createElement("p");d.classList.add("ticket-name"),d.textContent=t,i.append(a,d);const l=document.createElement("p");l.classList.add("ticket-date"),l.textContent=c;const u=document.createElement("a");u.classList.add("update-button"),u.textContent="✎";const h=document.createElement("a");return h.classList.add("delete-button"),h.textContent="X",r.append(l,u,h),o.append(i,r),a.addEventListener("click",this.onDoneButton),u.addEventListener("click",this.onUpdateButton),h.addEventListener("click",this.onDeleteButton),o.addEventListener("click",this.onTicketClick),o}async onDoneButton(t){t.stopPropagation();const e=t.target.closest(".ticket-wrapper"),n=e.getAttribute("data-id"),s="true"===e.getAttribute("data-status");await this.ticketService.update(n,{status:!s}),await this.helpDesk.renderTicketList()}async onUpdateButton(t){if(t.stopPropagation(),document.querySelector(".form"))return;const e=t.target.closest(".ticket-wrapper").getAttribute("data-id"),n=await this.ticketService.get(e),s=document.querySelector(".container"),c=this.updateModal.renderForm(n);s.appendChild(c)}onDeleteButton(t){t.stopPropagation();const e=document.querySelector(".delete-block"),n=document.querySelector(".container");if(e)return;const s=t.target.closest(".ticket-wrapper").getAttribute("data-id");n.appendChild(this.renderDeleteModal(s))}renderDeleteModal(t){const e=document.createElement("div");e.classList.add("delete-block"),e.setAttribute("data-id",t);const n=document.createElement("p");n.classList.add("delete-block-title"),n.textContent="Удалить тикет";const s=document.createElement("p");s.classList.add("delete-block-text"),s.textContent="Вы уверены, что хотите удалить тикет? Это действие необратимо.";const c=document.createElement("div");c.classList.add("button-block");const o=document.createElement("a");o.classList.add("cancel-button"),o.textContent="Отмена";const i=document.createElement("a");return i.classList.add("approve-button"),i.textContent="Ок",c.append(o,i),e.append(n,s,c),o.addEventListener("click",this.closeDeleteBlock),i.addEventListener("click",this.sendDeleteRequest),e}closeDeleteBlock(){const t=document.querySelector(".delete-block");t&&t.remove()}async sendDeleteRequest(t){try{const e=t.target.closest(".delete-block").getAttribute("data-id");await this.ticketService.delete(e),await this.helpDesk.renderTicketList(),this.closeDeleteBlock()}catch(t){console.error("Что-то пошло не так при удалении тикета:",t.message)}}async onTicketClick(t){try{const e=t.target.closest(".ticket-wrapper"),n=e.querySelector(".description");if(n)return void n.remove();const s=e.getAttribute("data-id"),c=await this.ticketService.get(s);if(!c.description)return;const o=document.createElement("div");o.classList.add("description"),o.textContent=c.description,e.appendChild(o)}catch(t){console.error(t)}}}const i="http://localhost:3000/",r=document.getElementById("root"),a=new n(i),d=new class{constructor(t,e){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.tickets=[],this.container=t,this.ticketService=e,this.ticketForm=new s(this),this.onAddTicketBtn=this.onAddTicketBtn.bind(this)}init(){this.renderApp(),this.renderTicketList()}renderApp(){const t=document.createElement("div");t.classList.add("container");const e=document.createElement("a");e.classList.add("add-ticket-button"),e.textContent="Добавить тикет";const n=document.createElement("ul");n.classList.add("tickets-list"),this.container.appendChild(t),t.append(e,n),e.addEventListener("click",this.onAddTicketBtn)}async renderTicketList(){const e=document.querySelector(".tickets-list");e.textContent="";const n=(await this.ticketService.list()).map((e=>new t(e)));this.tickets=n;const s=new o(this.tickets,this);n.forEach((t=>{const n=s.renderTicket(t.name,t.created,t.status,t.id);e.appendChild(n)}))}onAddTicketBtn(){if(document.querySelector(".form"))return;const t=this.ticketForm.renderForm();this.container.appendChild(t)}}(r,a);d.init()})();